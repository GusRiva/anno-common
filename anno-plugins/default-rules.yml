# See [sift-rule](https://github.com/kba/sift-rule) for rule mechanics
#
# Structure is
# [ CONDITION, RESULT, DESCRIPTION ]
#
# CONDITION is a sift query on collection, annotation, user and method
# RESULT is a tru-ish value to allow or false to deny request
# DESCRIPTION is an optional description of the rule

# - - collection: 'test-collection'
#   - true
#   - "Allow everybody to do everything on 'test-collection'"

- - user.inactive: true
  - false
  - "Inactive users are not allowed to do anything"

- - method: {$or: ['init', 'aclCheck', 'get', 'search']}
  - true
  - "Allow store initialization, rights checks, search and retrieval for anyone by default"

- - user.role: 'admin'
  - true
  - "Allow users with 'admin' role to do everything"

- - method: {$or: ['create', 'revise']}
    user.role: 'moderator'
  - true
  - "Allow moderators to revise / reply to any annotations"

- - method: 'create'
    user.role: 'create'
  - true
  - "Allow users with 'create' role to create new annotations"

- - method: {$or: ['revise', 'create']}
    anno.creator: {$exists: true}
    user.id: {$exists: true}
    $or:
    - anno.creator: {$ref: '/user/id'}
    - anno.creator.id: {$ref: '/user/id'}
  - true
  - "Allow users to revise their own annotations / Allow users to reply to their own annotations"

# Default Rule. Must be last
- - {}
  - false
  - "Fallback to disallow any interaction"
